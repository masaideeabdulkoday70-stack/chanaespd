<style>
  /* แก้สีปุ่มแท็บให้ขาวชัดเจนเวลาเลือก */
  .nav-pills .nav-link.active { 
    background-color: #4361ee !important; 
    color: #ffffff !important; 
    box-shadow: 0 4px 15px rgba(67, 97, 238, 0.3);
    border: none;
    font-weight: 600;
  }
  .nav-link { color: #64748b; transition: 0.3s; }
</style>

<script>
  function render(filter, el) {
    if(el) {
      document.querySelectorAll('#tabs .nav-link').forEach(b => b.classList.remove('active'));
      el.classList.add('active');
    }
    
    let summary = {};
    // ดึงชื่อและตำแหน่งจาก cache โดยล้างช่องว่างออก (Trim)
    cache.staff.forEach(s => {
      let cleanPos = s.pos ? s.pos.toString().trim() : "ไม่ระบุตำแหน่ง";
      summary[s.name] = { pos: cleanPos, k:0, p:0, pk:0, s:0 };
    });

    // รวมยอดวันลา
    cache.leaves.forEach(l => {
      let cleanName = l.name ? l.name.toString().trim() : "";
      if(summary[cleanName]) {
        if(l.type.includes('กิจ')) summary[cleanName].k += l.days;
        else if(l.type.includes('ป่วย')) summary[cleanName].p += l.days;
        else if(l.type.includes('พักผ่อน')) summary[cleanName].pk += l.days;
        else if(l.type.includes('สาย')) summary[cleanName].s += 1;
      }
    });

    let h = "", t = { k:0, p:0, pk:0, s:0 };
    Object.keys(summary).sort().forEach(name => {
      let item = summary[name];
      // ใช้ .includes เพื่อให้ดึงข้อมูลได้แม่นยำขึ้น
      if(filter === 'ทั้งหมด' || item.pos.includes(filter)) {
        t.k += item.k; t.p += item.p; t.pk += item.pk; t.s += item.s;
        h += `<tr><td class="text-start ps-4 fw-bold">${name}</td><td><small class="badge bg-light text-muted border">${item.pos}</small></td><td>${item.k}</td><td>${item.p}</td><td>${item.pk}</td><td>${item.s}</td></tr>`;
      }
    });
    
    // แสดงยอดรวมท้ายตาราง
    h += `<tr class="total-row" style="background:#1a1c2e; color:white;">
            <td colspan="2">รวมยอดกลุ่ม (${filter})</td>
            <td>${t.k}</td><td>${t.p}</td><td>${t.pk}</td><td>${t.s}</td>
          </tr>`;
    document.getElementById('tbody').innerHTML = h;
  }
</script>
